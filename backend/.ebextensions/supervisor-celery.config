# This file sets up Celery and Celery Beat using Supervisor.
# It should be placed in the .ebextensions directory.

files:
  "/etc/supervisor/conf.d/celery.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      [program:celery]
      command=celery -A backend worker -l info
      directory=/var/app/current
      autostart=true
      autorestart=true
      stdout_logfile=/var/log/celery-worker.log
      stderr_logfile=/var/log/celery-worker.err.log
  
  "/etc/supervisor/conf.d/celerybeat.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      [program:celerybeat]
      command=celery -A backend beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler
      directory=/var/app/current
      autostart=true
      autorestart=true
      stdout_logfile=/var/log/celery-beat.log
      stderr_logfile=/var/log/celery-beat.err.log
